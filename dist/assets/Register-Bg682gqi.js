import{_ as z,u as D,r as N,a as c,c as q,o as B,b as F,w as R,U as T,d as k,e as L,f as i,g as l,t as s,h as O,i as d,j as h,k as u,v as p,n as Z,F as U,l as V,m as E}from"./index-BT3itL6u.js";const j={class:"register-container"},G={class:"platform-row"},H=["placeholder"],J=["placeholder"],K=["placeholder"],Q={key:1,class:"error"},W=["placeholder"],X={class:"platform-row"},Y=["placeholder"],x={key:2},ee=["placeholder"],te={key:0,class:"error"},re=["placeholder"],ae=["placeholder"],le=["placeholder"],se=["onUpdate:modelValue"],oe={disabled:"",value:""},ne=["value"],ie=["onUpdate:modelValue","onInput","placeholder"],ue=["disabled"],de=["onClick"],pe={type:"submit",class:"btn-primary btn-lg mt-4"},me={__name:"Register",setup(ce){const{t:n}=D(),$=L(),t=N({username:"",password:"",real_name:"",phone:"",referral_id:"",bank_name:"",bank_account:"",platforms:[{platform_id:"",platform_user_id:""}]}),b=c(""),y=c(!1),v=c(""),w=q(()=>b.value&&b.value!==t.password),P=c([]);B(async()=>{try{const e=localStorage.getItem("lang")||"ko",r=await k.get(`http://localhost:3000/platforms?lang=${e}`);P.value=r.data}catch(e){console.error("플랫폼 목록 로딩 실패:",e)}});const I=()=>{const e=t.platforms.length-1,r=t.platforms[e];if(!r.platform_id){alert(n("register.alert.selectPlatformFirst"));return}if(t.platforms.slice(0,e).map(f=>f.platform_id).includes(r.platform_id)){alert(n("register.alert.noDuplicatePlatform"));return}t.platforms.length<4&&t.platforms.push({platform_id:"",platform_user_id:""})},C=e=>{t.platforms.splice(e,1)},A=async()=>{var f,o;if(w.value){alert(n("register.alert.passwordMismatch"));return}for(const m of t.platforms)if(!m.platform_id||!m.platform_user_id){alert(n("register.alert.enterAllPlatformInfo"));return}const e=t.platforms.map(m=>m.platform_id);if(new Set(e).size!==e.length){alert(n("register.alert.noDuplicatePlatform"));return}const a={...t,platforms:t.platforms.map(m=>({platform_id:m.platform_id,platform_user_id:m.platform_user_id}))};try{await k.post("http://localhost:3000/users/register",a),alert(n("register.alert.registrationSuccess")),$.push("/home")}catch(m){alert(((o=(f=m.response)==null?void 0:f.data)==null?void 0:o.message)||n("register.alert.registrationFail"))}};c(""),c(""),c([""]);const g=c(""),_=c(!1),M=async()=>{if(g.value="",_.value=!1,!t.username){alert(n("register.alert.enterUsername"));return}try{(await k.post("http://localhost:3000/users/check-username",{username:t.username})).data.available?(g.value=n("register.alert.usernameAvailable"),_.value=!0):g.value=n("register.alert.usernameTaken")}catch{g.value=n("register.alert.checkError")}},S=()=>{$.push("/login")};return(e,r)=>(i(),F(T,null,{default:R(()=>[l("div",j,[l("h2",null,s(e.$t("register.title")),1),l("form",{onSubmit:O(A,["prevent"])},[l("label",null,s(e.$t("register.username")),1),l("div",G,[u(l("input",{"onUpdate:modelValue":r[0]||(r[0]=a=>t.username=a),onInput:r[1]||(r[1]=a=>t.username=t.username.replace(/[^a-zA-Z0-9]/g,"")),placeholder:e.$t("register.usernamePlaceholder"),required:""},null,40,H),[[p,t.username]]),l("button",{type:"button",class:"btn-primary btn-sm",onClick:M},s(e.$t("register.checkAvailability")),1)]),g.value?(i(),d("p",{key:0,style:Z({color:_.value?"green":"red",fontSize:"0.9em",marginTop:"5px"})},s(g.value),5)):h("",!0),l("label",null,s(e.$t("register.password")),1),u(l("input",{type:"password","onUpdate:modelValue":r[2]||(r[2]=a=>t.password=a),placeholder:e.$t("register.passwordPlaceholder"),required:""},null,8,J),[[p,t.password]]),l("label",null,s(e.$t("register.confirmPassword")),1),u(l("input",{type:"password","onUpdate:modelValue":r[3]||(r[3]=a=>b.value=a),placeholder:e.$t("register.passwordPlaceholder"),required:""},null,8,K),[[p,b.value]]),w.value?(i(),d("p",Q,s(e.$t("register.passwordMismatch")),1)):h("",!0),l("label",null,s(e.$t("register.realName")),1),u(l("input",{"onUpdate:modelValue":r[4]||(r[4]=a=>t.real_name=a),placeholder:e.$t("register.realName"),required:""},null,8,W),[[p,t.real_name]]),l("label",null,s(e.$t("register.phone")),1),l("div",X,[u(l("input",{"onUpdate:modelValue":r[5]||(r[5]=a=>t.phone=a),placeholder:e.$t("register.phone"),required:""},null,8,Y),[[p,t.phone]]),l("button",{type:"button",class:"btn-primary btn-sm",onClick:r[6]||(r[6]=a=>y.value=!0)},s(e.$t("register.verifyCode")),1)]),y.value?(i(),d("div",x,[u(l("input",{"onUpdate:modelValue":r[7]||(r[7]=a=>v.value=a),placeholder:e.$t("register.codePlaceholder")},null,8,ee),[[p,v.value]]),v.value!=="1234"?(i(),d("p",te,s(e.$t("register.codeInvalid")),1)):h("",!0)])):h("",!0),l("label",null,s(e.$t("register.referral")),1),u(l("input",{"onUpdate:modelValue":r[8]||(r[8]=a=>t.referral_id=a),onInput:r[9]||(r[9]=a=>t.referral_id=t.referral_id.replace(/[^a-zA-Z0-9]/g,"")),placeholder:e.$t("register.referral")},null,40,re),[[p,t.referral_id]]),l("label",null,s(e.$t("register.bankName")),1),u(l("input",{"onUpdate:modelValue":r[10]||(r[10]=a=>t.bank_name=a),placeholder:e.$t("register.bankName")},null,8,ae),[[p,t.bank_name]]),l("label",null,s(e.$t("register.bankAccount")),1),u(l("input",{"onUpdate:modelValue":r[11]||(r[11]=a=>t.bank_account=a),placeholder:e.$t("register.bankAccount")},null,8,le),[[p,t.bank_account]]),l("label",null,s(e.$t("register.platform")),1),(i(!0),d(U,null,V(t.platforms,(a,f)=>(i(),d("div",{key:f,class:"platform-row"},[u(l("select",{"onUpdate:modelValue":o=>a.platform_id=o},[l("option",oe,s(e.$t("register.platform")),1),(i(!0),d(U,null,V(P.value,o=>(i(),d("option",{key:o.id,value:o.id},s(o.name),9,ne))),128))],8,se),[[E,a.platform_id]]),u(l("input",{"onUpdate:modelValue":o=>a.platform_user_id=o,onInput:o=>a.platform_user_id=a.platform_user_id.replace(/[^a-zA-Z0-9]/g,""),placeholder:e.$t("register.usernamePlaceholder")},null,40,ie),[[p,a.platform_user_id]]),f===t.platforms.length-1?(i(),d("button",{key:0,type:"button",class:"btn-primary btn-sm",onClick:I,disabled:t.platforms.length>=4},s(e.$t("register.addPlatform")),9,ue)):h("",!0),t.platforms.length>1?(i(),d("button",{key:1,type:"button",class:"btn-dark btn-sm",onClick:o=>C(f)},s(e.$t("register.removePlatform")),9,de)):h("",!0)]))),128)),l("button",pe,s(e.$t("register.submit")),1)],32),l("button",{type:"button",class:"btn-dark btn-lg mt-4",onClick:S},s(e.$t("register.login")),1)])]),_:1}))}},he=z(me,[["__scopeId","data-v-4ad7a737"]]);export{he as default};
