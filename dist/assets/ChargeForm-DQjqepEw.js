import{_ as j,u as N,a as n,o as z,p as v,c as w,b as W,w as K,U as O,e as Y,f as c,g as e,i,j as q,t as a,k as f,m as S,F as C,l as D,v as G}from"./index-BT3itL6u.js";const J={class:"form_box"},Q={class:"form-group"},X={disabled:"",value:""},Z={value:"KRW"},x={value:"PHP"},ee={value:"USDT"},te={class:"form-group"},ae={disabled:"",value:""},le=["value"],oe={class:"form-group"},re=["value"],se={class:"form-group"},ne=["placeholder"],ue={class:"form-group"},ce=["value"],ie={class:"text-muted"},de={key:0,class:"form-group"},he={class:"detail-summary"},ge={class:"details"},ve={key:1,class:"history-list"},me={class:"history-header"},pe={key:2,style:{"text-align":"center","margin-top":"2rem"}},ye={__name:"ChargeForm",setup(fe){const{t:u}=N(),d=n(""),g=n(""),s=n(0),m=n(0),h=n(0),_=n({}),r=n(""),y=n([]),$=n([]),U=async()=>{const t=localStorage.getItem("lang")||"ko";try{const l=await v.get(`/platforms?lang=${t}`);$.value=l.data}catch(l){console.error("플랫폼 목록 불러오기 실패:",l)}};z(async()=>{localStorage.getItem("user_token");try{const t=await v.get("/users/me");_.value=t.data.platform_ids||{}}catch(t){console.error(t)}await U(),await b()});const I=async()=>{if(!r.value)return;const t={USDT:1};try{const o=(await v.get("/exchange-rate")).data.rates[r.value]||t[r.value];if(!o)throw new Error(u("charge.alert.noExchange"));m.value=o*1.02,k()}catch(l){console.error("환율 조회 실패:",l)}},P=()=>{g.value=_.value[d.value]||""},k=()=>{h.value=Math.round(s.value*m.value)},A=w(()=>h.value>0?`${h.value.toLocaleString()} ${r.value}`:""),M=w(()=>m.value?m.value.toFixed(2):"-"),R=async()=>{if(!d.value||!g.value||!s.value||!r.value){alert(u("charge.alert.fillAll"));return}if(s.value<40){alert(u("charge.alert.minimumAmount"));return}try{const t=localStorage.getItem("user_token");await v.post("/api/transactions",{type:"charge",amount:s.value,currency:r.value,local_amount:h.value,platform_id:d.value,platform_user_id:g.value},{headers:{Authorization:`Bearer ${t}`}}),alert(u("charge.alert.success")),d.value="",g.value="",s.value=0,h.value=0,r.value="",await b()}catch(t){alert(u("charge.alert.error")),console.error(t)}},b=async()=>{const t=localStorage.getItem("user_token");try{const l=await v.get("/users/me/transactions",{headers:{Authorization:`Bearer ${t}`}});y.value=l.data.transactions||[]}catch(l){console.error("충전 이력 로딩 실패:",l)}},B=t=>{const l=new Date(t),o=l.getFullYear(),p=l.getMonth()+1,L=l.getDate(),V=l.getHours().toString().padStart(2,"0"),T=l.getMinutes().toString().padStart(2,"0");return`${o}.${p}.${L} ${V}:${T}`},F=t=>{switch(t){case"pending":return u("charge.status.pending");case"completed":return u("charge.status.completed");case"rejected":return u("charge.status.rejected");default:return t}},H=Y(),E=()=>{H.push("/trade/history")};return(t,l)=>(c(),W(O,null,{default:K(()=>[e("div",J,[e("h2",null,"🔋 "+a(t.$t("charge.title")),1),e("div",Q,[e("label",null,a(t.$t("charge.selectCurrency")),1),f(e("select",{"onUpdate:modelValue":l[0]||(l[0]=o=>r.value=o),onChange:I},[e("option",X,a(t.$t("charge.selectPlaceholder")),1),e("option",Z,"₩ "+a(t.$t("charge.koreanWon")),1),e("option",x,"₱ "+a(t.$t("charge.philippinePeso")),1),e("option",ee,"₮ "+a(t.$t("charge.usdt")),1)],544),[[S,r.value]])]),e("div",te,[e("label",null,a(t.$t("charge.selectPlatform")),1),f(e("select",{"onUpdate:modelValue":l[1]||(l[1]=o=>d.value=o),onChange:P},[e("option",ae,a(t.$t("charge.selectPlaceholder")),1),(c(!0),i(C,null,D($.value,o=>(c(),i("option",{key:o.id,value:o.id},a(o.name),9,le))),128))],544),[[S,d.value]])]),e("div",oe,[e("label",null,a(t.$t("charge.platformId")),1),e("input",{type:"text",value:g.value,readonly:"",class:"readonly-input"},null,8,re)]),e("div",se,[e("label",null,a(t.$t("charge.inputUsd")),1),f(e("input",{type:"number","onUpdate:modelValue":l[2]||(l[2]=o=>s.value=o),placeholder:t.$t("charge.inputPlaceholder"),onInput:k},null,40,ne),[[G,s.value,void 0,{number:!0}]])]),e("div",ue,[e("label",null,a(t.$t("charge.totalSend"))+" ("+a(r.value)+")",1),e("input",{type:"text",value:A.value,readonly:"",class:"readonly-input"},null,8,ce),e("small",ie,a(t.$t("charge.feeNote")),1)]),s.value>0?(c(),i("div",de,[e("details",null,[e("summary",he,a(t.$t("charge.viewDetails")),1),e("ul",ge,[e("li",null,a(t.$t("charge.rate"))+": "+a(M.value)+" "+a(r.value),1),e("li",null,a(t.$t("charge.amountUsd"))+": "+a(s.value)+" USD",1),e("li",null,a(t.$t("charge.totalConverted"))+": "+a(Math.round(h.value).toLocaleString())+" "+a(r.value),1)])])])):q("",!0),e("button",{class:"btn-submit",onClick:R},a(t.$t("charge.submit")),1),y.value.length?(c(),i("div",ve,[e("div",me,[e("h3",null,"📋 "+a(t.$t("charge.recentHistory")),1),e("span",{class:"more-link",onClick:E},a(t.$t("charge.viewMore"))+" 🢒",1)]),e("table",null,[e("thead",null,[e("tr",null,[e("th",null,a(t.$t("charge.date")),1),l[3]||(l[3]=e("th",null,"$",-1)),e("th",null,a(t.$t("charge.currency")),1),e("th",null,a(t.$t("charge.amount")),1),e("th",null,a(t.$t("charge.statusth")),1)])]),e("tbody",null,[(c(!0),i(C,null,D(y.value.slice(0,10),o=>{var p;return c(),i("tr",{key:o.id},[e("td",null,a(B(o.created_at)),1),e("td",null,a(o.amount),1),e("td",null,a(o.currency),1),e("td",null,a((p=o.krw_amount)==null?void 0:p.toLocaleString()),1),e("td",null,a(F(o.status)),1)])}),128))])])])):(c(),i("p",pe,a(t.$t("charge.noHistory")),1))])]),_:1}))}},$e=j(ye,[["__scopeId","data-v-2c0ead61"]]);export{$e as default};
