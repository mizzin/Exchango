import{_ as S,a as m,r as z,o as O,b as j,w as I,A as L,d as k,e as F,f as o,g as e,i as r,j as N,k as c,s as C,v as b,m as T,y as E,F as h,l as w,t as v,z as R}from"./index-BUlgKWMI.js";const q={class:"admin-users"},G={class:"filter-row"},H={class:"checkbox-label"},J={class:"filter-row"},K=["onClick"],Q=["onClick"],W={key:1},X={key:2},Y={key:3},Z=["onClick"],tt={key:0,class:"pagination"},et=["disabled"],at=["onClick"],nt=["disabled"],st=15,lt={__name:"AdminUserList",setup(ot){const D=F(),g=m([]),i=m(1),p=m(1),_=m([]),s=z({username:"",status:"",startDate:"",endDate:"",warningOnly:!1,platform:"",referral_id:""}),y=m([]),V=async()=>{try{const n=await k.get("/platforms?lang=ko");y.value=(n.data.platforms||[]).filter(t=>t.name)}catch(n){console.error("플랫폼 목록 불러오기 실패:",n),y.value=[]}},d=async()=>{const n=localStorage.getItem("admin_token");try{const t=await k.get("http://localhost:3000/admin/users",{headers:{Authorization:`Bearer ${n}`},params:{...s,page:i.value,limit:st}});g.value=t.data.users,p.value=t.data.totalPages,U()}catch(t){console.error("❌ 사용자 목록 로딩 실패:",t)}},$=()=>{s.username="",s.status="",s.startDate="",s.endDate="",s.warningOnly=!1,s.platform="",s.referral_id="",d()},f=n=>{n<1||n>p.value||(i.value=n,d())},U=()=>{const n=[];let a=Math.max(1,i.value-2),l=Math.min(p.value,a+5-1);l-a<4&&(a=Math.max(1,l-5+1));for(let u=a;u<=l;u++)n.push(u);_.value=n},A=async n=>{const t=localStorage.getItem("admin_token");await k.patch(`http://localhost:3000/admin/users/${n}/approve`,{},{headers:{Authorization:`Bearer ${t}`}}),alert("승인 완료"),d()},B=async n=>{var l,u;const t=prompt("거절 사유를 입력하세요:");if(t===null||t.trim()===""){alert("거절 사유를 입력해야 합니다.");return}const a=localStorage.getItem("admin_token");try{await k.patch(`http://localhost:3000/admin/users/${n}/reject`,{reason:t},{headers:{Authorization:`Bearer ${a}`}}),alert("거절 완료"),d()}catch(x){alert("거절 실패: "+(((u=(l=x.response)==null?void 0:l.data)==null?void 0:u.message)||x.message))}},M=n=>new Date(n).toLocaleDateString(),P=n=>{D.push(`/admin/users/${n}`)};return O(()=>{V(),d()}),(n,t)=>(o(),j(L,null,{default:I(()=>[e("div",q,[t[12]||(t[12]=e("h2",null,"회원 목록",-1)),e("div",G,[c(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>s.username=a),placeholder:"아이디"},null,512),[[b,s.username]]),c(e("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>s.status=a)},t[8]||(t[8]=[e("option",{value:""},"전체 상태",-1),e("option",{value:"pending"},"대기중",-1),e("option",{value:"approved"},"승인됨",-1),e("option",{value:"blocked"},"차단됨",-1)]),512),[[T,s.status]]),c(e("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=a=>s.startDate=a)},null,512),[[b,s.startDate]]),t[10]||(t[10]=C(" ~ ")),c(e("input",{type:"date","onUpdate:modelValue":t[3]||(t[3]=a=>s.endDate=a)},null,512),[[b,s.endDate]]),e("label",H,[c(e("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=a=>s.warningOnly=a)},null,512),[[E,s.warningOnly]]),t[9]||(t[9]=C(" 경고 1회 이상 "))])]),e("div",J,[c(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>s.referral_id=a),placeholder:"추천인 ID"},null,512),[[b,s.referral_id]]),e("button",{onClick:d},"검색"),e("button",{onClick:$},"초기화")]),e("table",null,[t[11]||(t[11]=e("thead",null,[e("tr",null,[e("th",null,"아이디"),e("th",null,"이름"),e("th",null,"상태"),e("th",null,"가입일"),e("th",null,"승인 여부"),e("th",null,"상세")])],-1)),e("tbody",null,[(o(!0),r(h,null,w(g.value,a=>(o(),r("tr",{key:a.id},[e("td",null,v(a.username),1),e("td",null,v(a.real_name||"-"),1),e("td",null,v(a.status||"-"),1),e("td",null,v(a.created_at?M(a.created_at):"-"),1),e("td",null,[a.status==="pending"?(o(),r(h,{key:0},[e("button",{class:"btn-approve",onClick:l=>A(a.id)},"승인",8,K),e("button",{class:"btn-reject",onClick:l=>B(a.id)},"거절",8,Q)],64)):a.status==="approved"?(o(),r("span",W,"승인됨")):a.status==="rejected"?(o(),r("span",X,"거절됨")):(o(),r("span",Y,"처리완료"))]),e("td",null,[e("button",{onClick:l=>P(a.id)},"상세보기",8,Z)])]))),128))])]),p.value>1?(o(),r("div",tt,[e("button",{onClick:t[6]||(t[6]=a=>f(i.value-1)),disabled:i.value===1},"이전",8,et),(o(!0),r(h,null,w(_.value,a=>(o(),r("span",{key:a},[e("button",{class:R({active:i.value===a}),onClick:l=>f(a)},v(a),11,at)]))),128)),e("button",{onClick:t[7]||(t[7]=a=>f(i.value+1)),disabled:i.value===p.value},"다음",8,nt)])):N("",!0)])]),_:1}))}},it=S(lt,[["__scopeId","data-v-967b71b3"]]);export{it as default};
