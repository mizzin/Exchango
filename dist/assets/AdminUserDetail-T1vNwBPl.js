import{_ as F,a as p,r as A,o as O,b as R,w as j,A as q,d as i,B as G,e as H,f as l,g as e,i as r,j as S,k as y,s as d,t as u,F as _,l as B,v as C,m as J}from"./index-BUlgKWMI.js";const K={class:"admin-user-detail"},Q={key:0},W={key:0},X={key:1,class:"platform-table"},Y=["onUpdate:modelValue"],Z={key:1},tt=["onClick"],et=["onClick"],ot={key:2},at={class:"platform-add-row"},lt=["value"],nt={style:{"margin-top":"1rem"}},rt={key:1},st={__name:"AdminUserDetail",setup(ut){const U=H(),m=G(),n=p(null),k=p(""),b=p([]),g=A({}),v=p(null),c=A({platform_id:"",platform_user_id:""}),w=p([]),x=async()=>{try{const a=localStorage.getItem("lang")||"ko",t=await i.get("http://localhost:3000/platforms?lang=ko");w.value=t.data}catch(a){console.error("플랫폼 목록 로딩 실패:",a)}};console.log(w.value);const $=async()=>{const a=localStorage.getItem("admin_token");try{const t=await i.get(`http://localhost:3000/admin/users/${m.params.id}/platforms`,{headers:{Authorization:`Bearer ${a}`}});b.value=t.data.platforms}catch(t){console.error("❌ 플랫폼 목록 로딩 실패:",t)}},z=(a,t)=>{g[a]=t,v.value=a},V=async a=>{var s,I;const t=localStorage.getItem("admin_token"),o=g[a];if(!o)return alert("플랫폼 아이디를 입력해주세요.");try{const h=await i.patch(`http://localhost:3000/admin/users/${m.params.id}/platforms/${a}`,{platform_user_id:o},{headers:{Authorization:`Bearer ${t}`}});alert(h.data.message),$()}catch(h){console.error("❌ 수정 실패:",h),alert(((I=(s=h.response)==null?void 0:s.data)==null?void 0:I.message)||"수정 실패")}},f=async()=>{const a=localStorage.getItem("admin_token");try{const t=await i.get(`http://localhost:3000/admin/users/${m.params.id}`,{headers:{Authorization:`Bearer ${a}`}});n.value=t.data.user,k.value=t.data.user.admin_note||"",console.log(n.value)}catch(t){console.error("❌ 사용자 상세 조회 실패:",t)}},D=async()=>{const a=localStorage.getItem("admin_token");try{await i.patch(`http://localhost:3000/admin/users/${m.params.id}/note`,{note:k.value},{headers:{Authorization:`Bearer ${a}`}}),alert("메모가 저장되었습니다.")}catch(t){console.error("❌ 메모 저장 실패:",t),alert("메모 저장 실패")}},N=async()=>{var t,o;const a=localStorage.getItem("admin_token");try{const s=await i.post(`http://localhost:3000/admin/users/${m.params.id}/platforms`,{...c},{headers:{Authorization:`Bearer ${a}`}});alert(s.data.message),$(),c.platform_name="",c.platform_user_id=""}catch(s){console.error("❌ 플랫폼 추가 실패:",s),alert(((o=(t=s.response)==null?void 0:t.data)==null?void 0:o.message)||"추가 실패")}},P=a=>{if(!a)return"-";const t=new Date(a);return isNaN(t.getTime())?"-":t.toLocaleDateString()},L=async()=>{const a=localStorage.getItem("admin_token");try{await i.patch(`http://localhost:3000/admin/users/${m.params.id}/block`,{},{headers:{Authorization:`Bearer ${a}`}}),alert("사용자가 차단되었습니다."),f()}catch(t){console.error("❌ 차단 실패:",t)}},T=async()=>{const a=localStorage.getItem("admin_token");try{await i.patch(`http://localhost:3000/admin/users/${m.params.id}/unblock`,{},{headers:{Authorization:`Bearer ${a}`}}),alert("차단이 해제되었습니다."),f()}catch(t){console.error("❌ 차단 해제 실패:",t),alert("차단 해제 실패")}},M=async()=>{const a=localStorage.getItem("admin_token");try{await i.patch(`http://localhost:3000/admin/users/${m.params.id}/warning`,{reason:"관리자 수동 경고",severity:1},{headers:{Authorization:`Bearer ${a}`}}),alert("경고가 부여되었습니다."),f()}catch(t){console.error("❌ 경고 실패:",t),alert("경고 실패")}},E=()=>{U.push("/admin/users")};return O(()=>{f(),$(),x()}),(a,t)=>(l(),R(q,null,{default:j(()=>[e("div",K,[t[21]||(t[21]=e("h2",null,"👤 사용자 상세 정보",-1)),n.value?(l(),r("div",Q,[e("p",null,[t[4]||(t[4]=e("strong",null,"아이디:",-1)),d(" "+u(n.value.username),1)]),e("p",null,[t[5]||(t[5]=e("strong",null,"이름:",-1)),d(" "+u(n.value.real_name||"-"),1)]),e("p",null,[t[6]||(t[6]=e("strong",null,"전화번호:",-1)),d(" "+u(n.value.phone||"-"),1)]),e("p",null,[t[7]||(t[7]=e("strong",null,"추천인:",-1)),d(" "+u(n.value.referral_id||"-"),1)]),e("p",null,[t[8]||(t[8]=e("strong",null,"상태:",-1)),d(" "+u(n.value.status),1)]),e("p",null,[t[9]||(t[9]=e("strong",null,"가입일:",-1)),d(" "+u(P(n.value.created_at)),1)]),e("p",null,[t[10]||(t[10]=e("strong",null,"경고 횟수:",-1)),d(" "+u(n.value.warning_count),1)]),e("p",null,[t[11]||(t[11]=e("strong",null,"은행명:",-1)),d(" "+u(n.value.bank_name||"-"),1)]),e("p",null,[t[12]||(t[12]=e("strong",null,"계좌번호:",-1)),d(" "+u(n.value.bank_account||"-"),1)]),n.value.platforms&&n.value.platforms.length?(l(),r("div",W,[t[13]||(t[13]=e("strong",null,"플랫폼 정보:",-1)),e("ul",null,[(l(!0),r(_,null,B(n.value.platforms,(o,s)=>(l(),r("li",{key:s},u(o.platform_name)+" - "+u(o.platform_user_id),1))),128))])])):S("",!0),t[16]||(t[16]=e("p",null,[e("strong",null,"관리자 메모:")],-1)),y(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=o=>k.value=o),rows:"4",style:{width:"100%"}},null,512),[[C,k.value]]),e("button",{onClick:D,class:"btn-save"},"메모 저장"),t[17]||(t[17]=e("hr",null,null,-1)),t[18]||(t[18]=e("h3",null,"등록된 플랫폼",-1)),b.value.length>0?(l(),r("table",X,[t[14]||(t[14]=e("thead",null,[e("tr",null,[e("th",null,"플랫폼 이름"),e("th",null,"플랫폼 아이디"),e("th",null,"수정")])],-1)),e("tbody",null,[(l(!0),r(_,null,B(b.value,o=>(l(),r("tr",{key:o.id},[e("td",null,u(o.platform_name),1),e("td",null,[v.value===o.id?y((l(),r("input",{key:0,"onUpdate:modelValue":s=>g[o.id]=s,style:{"min-width":"140px",color:"#000"}},null,8,Y)),[[C,g[o.id]]]):(l(),r("span",Z,u(o.platform_user_id),1))]),e("td",null,[v.value===o.id?(l(),r(_,{key:0},[e("button",{onClick:s=>V(o.id)},"저장",8,tt),e("button",{onClick:t[1]||(t[1]=s=>v.value=null)},"취소")],64)):(l(),r("button",{key:1,onClick:s=>z(o.id,o.platform_user_id)},"수정",8,et))])]))),128))])])):(l(),r("p",ot,"등록된 플랫폼이 없습니다.")),t[19]||(t[19]=e("h4",null,"➕ 플랫폼 추가",-1)),e("div",at,[y(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>c.platform_id=o)},[t[15]||(t[15]=e("option",{value:""},"플랫폼 선택",-1)),(l(!0),r(_,null,B(w.value,o=>(l(),r("option",{key:o.id,value:o.id},u(o.name),9,lt))),128))],512),[[J,c.platform_id]]),y(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>c.platform_user_id=o),placeholder:"플랫폼 아이디 입력"},null,512),[[C,c.platform_user_id]]),e("button",{onClick:N},"추가")]),t[20]||(t[20]=e("hr",null,null,-1)),e("div",nt,[e("button",{class:"btn-block",onClick:L},"🚫 차단"),e("button",{class:"btn-warning",onClick:M},"⚠️ 경고 부여"),n.value.status==="blocked"?(l(),r("button",{key:0,class:"btn-unblock",onClick:T},"🔓 차단 해제")):S("",!0),e("button",{class:"back-btn",onClick:E},"목록으로")])])):(l(),r("div",rt,"Loading..."))])]),_:1}))}},dt=F(st,[["__scopeId","data-v-e5daefa5"]]);export{dt as default};
