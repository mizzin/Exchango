import{_ as T,a as c,r as b,C as N,c as k,o as z,p as m,b as E,w as K,U as j,e as O,f as l,g as e,i as s,j as w,t as o,k as h,m as S,F as U,l as D,v as I,s as Y,y as q}from"./index-BUlgKWMI.js";const G={class:"form_box"},J={class:"form-group"},Q={disabled:"",value:""},X={value:"KRW"},Z={value:"PHP"},x={value:"USDT"},ee={class:"form-group"},te={disabled:"",value:""},ae=["value"],oe={class:"form-group"},re=["value"],ne={class:"form-group"},le={key:0,class:"form-group"},se=["value"],ue={key:1,class:"details-box"},ce={class:"detail-summary"},de={class:"details"},ie={key:2,class:"form-group"},me=["value"],he=["value"],pe={key:3,class:"form-group"},ye={for:"user_memo"},we=["placeholder"],ve={class:"alert-box"},_e={class:"form-group checkbox-inline"},ge=["disabled"],fe={key:4,class:"history-list"},$e={class:"history-header"},be={key:5,style:{"text-align":"center","margin-top":"2rem"}},ke={__name:"Withdraw",setup(Se){const u=c(0),d=c(0),i=c(""),_=c({}),v=c([]),p=b({bank_name:"",bank_account:""}),g=c([]),C=async()=>{const t=localStorage.getItem("lang")||"ko";try{const r=await m.get(`/platforms?lang=${t}`);g.value=r.data}catch(r){console.error("플랫폼 목록 불러오기 실패:",r)}},a=b({currency:"",amount:null,platform_id:"",user_memo:"",agree:!1});N(()=>a.platform_id,t=>{i.value=_.value[t]||""});const f=async()=>{if(!(!a.currency||!a.amount))try{const t=await m.get("/exchange-rate"),r={USDT:t.data.rates.USD??1},n=t.data.rates[a.currency]||r[a.currency];if(!n)throw new Error("선택한 통화 환율이 없습니다.");u.value=n*.98,d.value=Math.round(a.amount*u.value)}catch(t){console.error("❌ 환율 조회 실패:",t),alert("환율 정보를 가져오는 데 실패했습니다.")}},$=k(()=>d.value>0?`${d.value.toLocaleString()} ${a.currency}`:""),R=k(()=>u.value?u.value.toFixed(4):"-");z(async()=>{const t=localStorage.getItem("user_token");try{const r=await m.get("/users/me",{headers:{Authorization:`Bearer ${t}`}});_.value=r.data.platform_ids||{},p.bank_name=r.data.bank_name,p.bank_account=r.data.bank_account}catch(r){console.error("사용자 정보 로딩 실패:",r)}await V(),await C()});const W=async()=>{if(!a.agree)return alert("출금 정보 확인에 동의해주세요.");if(!a.platform_id||!i.value||!a.amount||!a.currency)return alert("모든 항목을 입력해주세요.");if(a.amount<40)return alert("최소 출금 금액은 $40입니다.");try{const t=localStorage.getItem("user_token");await m.post("/api/transactions/withdraw",{amount:a.amount,currency:a.currency,krw_amount:d.value,platform_id:a.platform_id,platform_user_id:i.value,user_memo:a.user_memo},{headers:{Authorization:`Bearer ${t}`}}),alert("출금 신청이 완료되었습니다."),a.currency="",a.amount=null,a.platform_id="",a.user_memo="",a.agree=!1,d.value=0,i.value=""}catch(t){console.error("❌ 출금신청 오류:",t),alert("신청 중 오류가 발생했습니다.")}},V=async()=>{const t=localStorage.getItem("user_token");try{const r=await m.get("/users/me/withdraws",{headers:{Authorization:`Bearer ${t}`}});v.value=r.data.transactions||[],console.log(r.data.transactions)}catch(r){console.error("출금 이력 로딩 실패:",r)}},A=t=>{const r=new Date(t),n=r.getFullYear(),y=r.getMonth()+1,H=r.getDate(),F=r.getHours().toString().padStart(2,"0"),L=r.getMinutes().toString().padStart(2,"0");return`${n}.${y}.${H} ${F}:${L}`},B=t=>{switch(t){case"pending":return"대기 중";case"completed":return"완료";case"rejected":return"거절됨";default:return t}},M=O(),P=()=>{M.push("/trade/history")};return(t,r)=>(l(),E(j,null,{default:K(()=>[e("div",G,[e("h2",null,o(t.$t("withdraw.title")),1),e("div",J,[e("label",null,o(t.$t("withdraw.selectCurrency")),1),h(e("select",{"onUpdate:modelValue":r[0]||(r[0]=n=>a.currency=n),onChange:f},[e("option",Q,o(t.$t("common.select")),1),e("option",X,"₩ "+o(t.$t("currency.krw")),1),e("option",Z,"₱ "+o(t.$t("currency.php")),1),e("option",x,"₮ "+o(t.$t("currency.usdt")),1)],544),[[S,a.currency]])]),e("div",ee,[e("label",null,o(t.$t("withdraw.selectPlatform")),1),h(e("select",{"onUpdate:modelValue":r[1]||(r[1]=n=>a.platform_id=n)},[e("option",te,o(t.$t("common.selectPrompt")),1),(l(!0),s(U,null,D(g.value,n=>(l(),s("option",{key:n.id,value:n.id},o(n.name),9,ae))),128))],512),[[S,a.platform_id]])]),e("div",oe,[e("label",null,o(t.$t("withdraw.platformId")),1),e("input",{type:"text",value:i.value,readonly:"",class:"readonly-input"},null,8,re)]),e("div",ne,[e("label",null,o(t.$t("withdraw.amountInput")),1),h(e("input",{type:"number","onUpdate:modelValue":r[2]||(r[2]=n=>a.amount=n),onInput:f,placeholder:"예: 100"},null,544),[[I,a.amount,void 0,{number:!0}]])]),a.amount>=40&&u.value?(l(),s("div",le,[e("label",null,o(t.$t("withdraw.expectedReceive",{currency:a.currency})),1),e("input",{type:"text",value:$.value,readonly:"",class:"readonly-input"},null,8,se)])):w("",!0),a.amount>=40&&u.value?(l(),s("div",ue,[e("details",null,[e("summary",ce,o(t.$t("withdraw.viewDetails")),1),e("ul",de,[e("li",null,o(t.$t("withdraw.rateWithFee"))+": "+o(R.value)+" "+o(a.currency),1),e("li",null,o(t.$t("withdraw.amountUsd"))+": "+o(a.amount)+" USD",1),e("li",null,o(t.$t("withdraw.estimatedReceive"))+": "+o($.value),1)])])])):w("",!0),a.currency==="KRW"?(l(),s("div",ie,[e("label",null,o(t.$t("withdraw.bankName")),1),e("input",{type:"text",value:p.bank_name,readonly:"",class:"readonly-input"},null,8,me),e("label",null,o(t.$t("withdraw.bankAccount")),1),e("input",{type:"text",value:p.bank_account,readonly:"",class:"readonly-input"},null,8,he)])):w("",!0),a.currency!=="KRW"?(l(),s("div",pe,[e("label",ye,o(t.$t("withdraw.memoLabel")),1),h(e("textarea",{id:"user_memo","onUpdate:modelValue":r[3]||(r[3]=n=>a.user_memo=n),rows:"3",placeholder:t.$t("withdraw.memoPlaceholder"),class:"styled-textarea"},null,8,we),[[I,a.user_memo]])])):w("",!0),e("div",ve," ⚠️ "+o(t.$t("withdraw.onlyOwnAccount")),1),e("div",_e,[e("label",null,[h(e("input",{type:"checkbox","onUpdate:modelValue":r[4]||(r[4]=n=>a.agree=n)},null,512),[[q,a.agree]]),Y(" "+o(t.$t("withdraw.agreeCheck")),1)])]),e("button",{disabled:!a.agree,onClick:W},o(t.$t("withdraw.submit")),9,ge),v.value.length?(l(),s("div",fe,[e("div",$e,[e("h3",null,o(t.$t("withdraw.recentWithdraw")),1),e("span",{class:"more-link",onClick:P},o(t.$t("common.more"))+" 🢒",1)]),e("table",null,[e("thead",null,[e("tr",null,[e("th",null,o(t.$t("common.date")),1),r[5]||(r[5]=e("th",null,"$",-1)),e("th",null,o(t.$t("common.currency")),1),e("th",null,o(t.$t("charge.amount")),1),e("th",null,o(t.$t("common.status")),1)])]),e("tbody",null,[(l(!0),s(U,null,D(v.value,n=>{var y;return l(),s("tr",{key:n.id},[e("td",null,o(A(n.created_at)),1),e("td",null,o(n.amount),1),e("td",null,o(n.currency),1),e("td",null,o((y=n.krw_amount)==null?void 0:y.toLocaleString()),1),e("td",null,o(B(n.status)),1)])}),128))])])])):(l(),s("p",be,o(t.$t("withdraw.noHistory")),1))])]),_:1}))}},De=T(ke,[["__scopeId","data-v-22bcc343"]]);export{De as default};
